import cv2
import os
import json
import numpy as np


palette = np.array([
            (89, 161, 197),
            (67, 161, 255),
            (19, 222, 24),
            (186, 55, 2),
            (167, 146, 11),
            (190, 76, 98),
            (130, 172, 179),
            (115, 209, 128),
            (204, 79, 135),
            (136, 126, 185),
            (209, 213, 45),
            (44, 52, 10),
            (101, 158, 121),
            (179, 124, 12),
            (25, 33, 189),
            (45, 115, 11),
            (73, 197, 184),
            (62, 225, 221),
            (32, 46, 52),
            (20, 165, 16),
            (54, 15, 57),
            (12, 150, 9),
            (10, 46, 99),
            (94, 89, 46),
            (48, 37, 106),
            (42, 10, 96),
            (7, 164, 128),
            (98, 213, 120),
            (40, 5, 219),
            (54, 25, 150),
            (251, 74, 172),
            (0, 236, 196),
            (21, 104, 190),
            (226, 74, 232),
            (120, 67, 25),
            (191, 106, 197),
            (8, 15, 134),
            (21, 2, 1),
            (142, 63, 109),
            (133, 148, 146),
            (187, 77, 253),
            (155, 22, 122),
            (218, 130, 77),
            (164, 102, 79),
            (43, 152, 125),
            (185, 124, 151),
            (95, 159, 238),
            (128, 89, 85),
            (228, 6, 60),
            (6, 41, 210),
            (11, 1, 133),
            (30, 96, 58),
            (230, 136, 109),
            (126, 45, 174),
            (164, 63, 165),
            (32, 111, 29),
            (232, 40, 70),
            (55, 31, 198),
            (148, 211, 129),
            (10, 186, 211),
            (181, 201, 94),
            (55, 35, 92),
            (129, 140, 233),
            (70, 250, 116),
            (61, 209, 152),
            (216, 21, 138),
            (100, 0, 176),
            (3, 42, 70),
            (151, 13, 44),
            (216, 102, 88),
            (125, 216, 93),
            (171, 236, 47),
            (253, 127, 103),
            (205, 137, 244),
            (193, 137, 224),
            (36, 152, 214),
            (17, 50, 238),
            (154, 165, 67),
            (114, 129, 60),
            (119, 24, 48),
            (73, 8, 110),
        ],
                    dtype=np.uint8)

def load_input(path_bundle):
    im = cv2.imread(path_bundle['img_path'])  # OpenCV
    with open(path_bundle['json_path'], "r") as f:
        car_data = json.load(f)
    with open(path_bundle['grid_path'], "r") as f:
        grid_data = json.load(f)[path_bundle['road_seperator']]

    return im, car_data, grid_data


def path_load(road_path):
    road_seperator = road_path[-5:-3]
    img_path = os.path.join('img', road_path + '.jpg')
    json_path = os.path.join('json', road_path + '.json')
    grid_path = 'grid_info.json'
    return {'img_path': img_path, 'json_path': json_path, 'grid_path': grid_path, 'road_seperator': road_seperator}